{% extends 'base.html' %}
{% load static %}

{% block title %}Analytics - RRS Admin{% endblock %}

{% block breadcrumb %}
    <span>Analytics</span>
{% endblock %}

{% block content %}
    <div class="page-header">
        <h1 class="page-title">Reports Analytics</h1>
        <div class="header-actions">
            <span>Last updated: {% now "DATETIME_FORMAT" %}</span>
        </div>
    </div>

    <!-- Summary Stats -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-number">{{ total_reports }}</div>
            <div class="stat-label">Total Reports</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ reports_today }}</div>
            <div class="stat-label">Today's Reports</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ avg_response_time }}h</div>
            <div class="stat-label">Avg Response Time</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ resolution_rate }}%</div>
            <div class="stat-label">Resolution Rate</div>
        </div>
    </div>

    <!-- Charts Row 1 -->
    <div class="grid-2-col" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
        <div class="card">
            <div class="card-header">
                <h3>Reports by Category</h3>
            </div>
            <div class="card-body">
                <canvas id="categoryChart" height="250"></canvas>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h3>Reports by Status</h3>
            </div>
            <div class="card-body">
                <canvas id="statusChart" height="250"></canvas>
            </div>
        </div>
    </div>

    <!-- Charts Row 2 -->
    <div class="grid-2-col" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
        <div class="card">
            <div class="card-header">
                <h3>Reports Timeline (Last 30 Days)</h3>
            </div>
            <div class="card-body">
                <canvas id="timelineChart" height="250"></canvas>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h3>Response Time Distribution</h3>
            </div>
            <div class="card-body">
                <canvas id="responseTimeChart" height="250"></canvas>
            </div>
        </div>
    </div>

    <!-- Top Categories Table -->
    <div class="card">
        <div class="card-header">
            <h3>Category Performance</h3>
        </div>
        <div class="card-body">
            <table class="table">
                <thead>
                    <tr>
                        <th>Category</th>
                        <th>Total Reports</th>
                        <th>Avg Response Time</th>
                        <th>Resolution Rate</th>
                        <th>Priority Level</th>
                    </tr>
                </thead>
                <tbody>
                    {% for category in category_stats %}
                    <tr>
                        <td>{{ category.name }}</td>
                        <td>{{ category.total }}</td>
                        <td>{{ category.avg_response }} hours</td>
                        <td>{{ category.resolution_rate }}%</td>
                        <td>
                            {% if category.priority == 'High' %}
                            <span class="badge badge-danger">High</span>
                            {% elif category.priority == 'Medium' %}
                            <span class="badge badge-warning">Medium</span>
                            {% else %}
                            <span class="badge badge-success">Low</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
<script>
    // Category Distribution Chart
    const categoryCtx = document.getElementById('categoryChart').getContext('2d');
    new Chart(categoryCtx, {
        type: 'doughnut',
        data: {
            labels: ['Theft', 'Kidnapping', 'Corruption', 'House Fire', 'Road Accident', 'Other'],
            datasets: [{
                data: [25, 15, 20, 10, 20, 10], // Sample data
                backgroundColor: [
                    '#0088ce', '#00a896', '#e63946', '#ff9e00', '#6a4c93', '#8ac926'
                ]
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });

    // Status Distribution Chart
    const statusCtx = document.getElementById('statusChart').getContext('2d');
    new Chart(statusCtx, {
        type: 'pie',
        data: {
            labels: ['New', 'In Review', 'Forwarded', 'Actioned', 'Closed'],
            datasets: [{
                data: [15, 25, 20, 30, 10], // Sample data
                backgroundColor: [
                    '#0088ce', '#ffc107', '#17a2b8', '#28a745', '#6c757d'
                ]
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });

    // Timeline Chart
    const timelineCtx = document.getElementById('timelineChart').getContext('2d');
    new Chart(timelineCtx, {
        type: 'line',
        data: {
            labels: ['Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5', 'Day 6', 'Day 7'],
            datasets: [{
                label: 'Reports per Day',
                data: [12, 19, 8, 15, 12, 10, 14],
                borderColor: '#0088ce',
                backgroundColor: 'rgba(0, 136, 206, 0.1)',
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    // Response Time Chart
    const responseCtx = document.getElementById('responseTimeChart').getContext('2d');
    new Chart(responseCtx, {
        type: 'bar',
        data: {
            labels: ['< 1h', '1-4h', '4-12h', '12-24h', '> 24h'],
            datasets: [{
                label: 'Number of Reports',
                data: [15, 25, 30, 20, 10],
                backgroundColor: '#00a896'
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>
{% endblock %}